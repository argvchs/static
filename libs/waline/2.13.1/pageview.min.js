!function(e,t){"function"==typeof define&&define.amd?define("Waline",["exports"],t):"undefined"!=typeof exports?t(exports):(t(t={}),e.Waline=t)}("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:this,function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.version=e.pageviewCount=void 0;const c={"Content-Type":"application/json"},h=function(e){if("object"==typeof e&&e.errno)throw new TypeError(`Fetch ${1<arguments.length&&void 0!==arguments[1]?arguments[1]:""} failed with ${e.errno}: `+e.errmsg);return e},f=e=>{var{serverURL:a,lang:i,paths:l,signal:s}=e;return(()=>{let{serverURL:e,lang:t,paths:n,type:r,signal:o}={serverURL:a,lang:i,paths:l,type:["time"],signal:s};return fetch(`${e}/article?path=${encodeURIComponent(n.join(","))}&type=${encodeURIComponent(r.join(","))}&lang=`+t,{signal:o}).then(e=>e.json()).then(e=>h(e,"article count"))})().then(e=>Array.isArray(e)?e:[e])},u=e=>{e=function(e){let t=0<arguments.length&&void 0!==e?e:"";return t.replace(/\/$/u,"")}(e);return/^(https?:)?\/\//.test(e)?e:"https://"+e},g=e=>{"AbortError"!==e.name&&console.error(e.message)},d=e=>e.dataset.path||e.getAttribute("id"),y=(n,e)=>{e.forEach((e,t)=>{e.innerText=n[t].toString()})};e.pageviewCount=e=>{let{serverURL:n,path:r=window.location.pathname,selector:t=".waline-pageview-count",update:o=!0,lang:a="zh-CN"}=e;const i=new AbortController,l=Array.from(document.querySelectorAll(t)),s=e=>{e=d(e);return null!==e&&r!==e},p=t=>f({serverURL:u(n),paths:t.map(e=>d(e)||r),lang:a,signal:i.signal}).then(e=>y(e,t)).catch(g);if(o){const t=l.filter(e=>!s(e)),f=l.filter(s);(e=>{var{serverURL:e,lang:t,path:n,type:r,action:o}={...e,type:"time",action:"inc"};return fetch(e+"/article?lang="+t,{method:"POST",headers:c,body:JSON.stringify({path:n,type:r,action:o})}).then(e=>e.json()).then(e=>h(e,"article count"))})({serverURL:u(n),path:r,lang:a}).then(e=>y(new Array(t.length).fill(e),t)),f.length&&p(f)}else p(l);return i.abort.bind(i)},e.version="2.13.1"});