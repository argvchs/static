const e="2.2.0",t=e=>{"AbortError"!==e.name&&console.error(e.message)},r=(e,t="")=>{if("object"==typeof e&&e.errno)throw new TypeError(`Fetch ${t} failed with ${e.errno}: `+e.errmsg);return e},n=({serverURL:e,lang:t,paths:n,signal:a})=>fetch(`${e}/article?path=${encodeURIComponent(n.join(","))}&lang=`+t,{signal:a}).then(e=>e.json()).then(e=>r(e,"visit count")).then(e=>Array.isArray(e)?e:[e]),a=({serverURL:e,lang:t,path:n})=>fetch(e+"/article?lang="+t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:n})}).then(e=>e.json()).then(e=>r(e,"visit count")),o=e=>e.dataset.path||e.getAttribute("id"),l=(r,e)=>{e.forEach((e,t)=>{e.innerText=r[t].toString()})},i=({serverURL:e,path:i=window.location.pathname,selector:r=".waline-pageview-count",update:s=!0,lang:h="zh-CN"})=>{const c=new AbortController,g=Array.from(document.querySelectorAll(r)),p=e=>{e=o(e);return null!==e&&i!==e},f=r=>n({serverURL:e,paths:r.map(e=>o(e)||i),lang:h,signal:c.signal}).then(e=>l(e,r)).catch(t);if(s){const t=g.filter(e=>!p(e)),n=g.filter(p);a({serverURL:e,path:i,lang:h}).then(e=>l(new Array(t.length).fill(e),t)),n.length&&f(n)}else f(g);return c.abort.bind(c)};export{i as pageviewCount,e as version};