const e="2.8.0",t=e=>{[e=""]=[e];e=e.replace(/\/$/u,"");return/^(https?:)?\/\//.test(e)?e:"https://"+e},r=e=>{"AbortError"!==e.name&&console.error(e.message)},n={"Content-Type":"application/json"},a=(e,t="")=>{if("object"==typeof e&&e.errno)throw new TypeError(`Fetch ${t} failed with ${e.errno}: `+e.errmsg);return e},o=({serverURL:e,lang:t,paths:r,signal:n})=>fetch(`${e}/article?path=${encodeURIComponent(r.join(","))}&lang=`+t,{signal:n}).then(e=>e.json()).then(e=>a(e,"visit count")).then(e=>Array.isArray(e)?e:[e]),l=({serverURL:e,lang:t,path:r})=>fetch(e+"/article?lang="+t,{method:"POST",headers:n,body:JSON.stringify({path:r})}).then(e=>e.json()).then(e=>a(e,"visit count")),s=e=>e.dataset.path||e.getAttribute("id"),i=(r,e)=>{e.forEach((e,t)=>{e.innerText=r[t].toString()})},h=({serverURL:e,path:a=window.location.pathname,selector:n=".waline-pageview-count",update:h=!0,lang:c="zh-CN"})=>{const p=new AbortController,g=Array.from(document.querySelectorAll(n)),u=e=>{e=s(e);return null!==e&&a!==e},f=n=>o({serverURL:t(e),paths:n.map(e=>s(e)||a),lang:c,signal:p.signal}).then(e=>i(e,n)).catch(r);if(h){const r=g.filter(e=>!u(e)),n=g.filter(u);l({serverURL:t(e),path:a,lang:c}).then(e=>i(new Array(r.length).fill(e),r)),n.length&&f(n)}else f(g);return p.abort.bind(p)};export{h as pageviewCount,e as version};