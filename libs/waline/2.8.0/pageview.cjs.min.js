"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=e=>{[e=""]=[e];e=e.replace(/\/$/u,"");return/^(https?:)?\/\//.test(e)?e:"https://"+e},t=e=>{"AbortError"!==e.name&&console.error(e.message)},r={"Content-Type":"application/json"},n=(e,t="")=>{if("object"==typeof e&&e.errno)throw new TypeError(`Fetch ${t} failed with ${e.errno}: `+e.errmsg);return e},o=({serverURL:e,lang:t,paths:r,signal:o})=>fetch(`${e}/article?path=${encodeURIComponent(r.join(","))}&lang=`+t,{signal:o}).then(e=>e.json()).then(e=>n(e,"visit count")).then(e=>Array.isArray(e)?e:[e]),a=({serverURL:e,lang:t,path:o})=>fetch(e+"/article?lang="+t,{method:"POST",headers:r,body:JSON.stringify({path:o})}).then(e=>e.json()).then(e=>n(e,"visit count")),s=e=>e.dataset.path||e.getAttribute("id"),i=(r,e)=>{e.forEach((e,t)=>{e.innerText=r[t].toString()})};exports.pageviewCount=({serverURL:n,path:l=window.location.pathname,selector:r=".waline-pageview-count",update:h=!0,lang:p="zh-CN"})=>{const c=new AbortController,g=Array.from(document.querySelectorAll(r)),u=e=>{e=s(e);return null!==e&&l!==e},d=r=>o({serverURL:e(n),paths:r.map(e=>s(e)||l),lang:p,signal:c.signal}).then(e=>i(e,r)).catch(t);if(h){const t=g.filter(e=>!u(e)),o=g.filter(u);a({serverURL:e(n),path:l,lang:p}).then(e=>i(new Array(t.length).fill(e),t)),o.length&&d(o)}else d(g);return c.abort.bind(c)},exports.version="2.8.0";