const e="2.0.5",t=e=>{"AbortError"!==e.name&&console.error(e.message)},r=(e,t="")=>{if("object"==typeof e&&e.errno)throw new TypeError(`Fetch ${t} failed with ${e.errno}: `+e.errmsg);return e},n=({serverURL:e,paths:t,signal:n})=>fetch(e+"/article?path="+encodeURIComponent(t.join(",")),{signal:n}).then(e=>e.json()).then(e=>r(e,"visit count")).then(e=>Array.isArray(e)?e:[e]),o=({serverURL:e,path:t})=>fetch(e+"/article",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:t})}).then(e=>e.json()).then(e=>r(e,"visit count")),a=e=>e.dataset.path||e.getAttribute("id"),i=(r,e)=>{e.forEach((e,t)=>{e.innerText=r[t].toString()})},s=({serverURL:e,path:s=window.location.pathname,selector:r=".waline-pageview-count",update:h=!0})=>{const l=new AbortController,c=Array.from(document.querySelectorAll(r)),p=e=>{e=a(e);return null!==e&&s!==e},g=r=>n({serverURL:e,paths:r.map(e=>a(e)||s),signal:l.signal}).then(e=>i(e,r)).catch(t);if(h){const t=c.filter(e=>!p(e)),n=c.filter(p);o({serverURL:e,path:s}).then(e=>i(new Array(t.length).fill(e),t)),n.length&&g(n)}else g(c);return l.abort.bind(l)};export{s as pageviewCount,e as version};