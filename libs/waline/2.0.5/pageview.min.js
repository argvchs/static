!function(e,t){"function"==typeof define&&define.amd?define("Waline",["exports"],t):"undefined"!=typeof exports?t(exports):(t(t={}),e.Waline=t)}("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:this,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.version=e.pageviewCount=void 0,e.version="2.0.5";const l=e=>{"AbortError"!==e.name&&console.error(e.message)},h=function(e){if("object"==typeof e&&e.errno)throw new TypeError("Fetch ".concat(1<arguments.length&&void 0!==arguments[1]?arguments[1]:""," failed with ").concat(e.errno,": ").concat(e.errmsg));return e},f=e=>e.dataset.path||e.getAttribute("id"),p=(n,e)=>{e.forEach((e,t)=>{e.innerText=n[t].toString()})};e.pageviewCount=t=>{let{serverURL:e,path:n=window.location.pathname,selector:r=".waline-pageview-count",update:o=!0}=t;const i=new AbortController,a=Array.from(document.querySelectorAll(r)),s=e=>{e=f(e);return null!==e&&n!==e},c=t=>(e=>{let{serverURL:t,paths:n,signal:r}=e;return fetch("".concat(t,"/article?path=").concat(encodeURIComponent(n.join(","))),{signal:r}).then(e=>e.json()).then(e=>h(e,"visit count")).then(e=>Array.isArray(e)?e:[e])})({serverURL:e,paths:t.map(e=>f(e)||n),signal:i.signal}).then(e=>p(e,t)).catch(l);if(o){const t=a.filter(e=>!s(e)),l=a.filter(s);(e=>{var{serverURL:e,path:t}=e;return fetch("".concat(e,"/article"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:t})}).then(e=>e.json()).then(e=>h(e,"visit count"))})({serverURL:e,path:n}).then(e=>p(new Array(t.length).fill(e),t)),l.length&&c(l)}else c(a);return i.abort.bind(i)}});