"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=e=>{"AbortError"!==e.name&&console.error(e.message)},t={"Content-Type":"application/json"},r=(e,t="")=>{if("object"==typeof e&&e.errno)throw new TypeError(`Fetch ${t} failed with ${e.errno}: ${e.errmsg}`);return e},n=({serverURL:e,lang:t,paths:n,signal:o})=>fetch(`${e}/article?path=${encodeURIComponent(n.join(","))}&lang=${t}`,{signal:o}).then((e=>e.json())).then((e=>r(e,"visit count"))).then((e=>Array.isArray(e)?e:[e])),o=({serverURL:e,lang:n,path:o})=>fetch(`${e}/article?lang=${n}`,{method:"POST",headers:t,body:JSON.stringify({path:o})}).then((e=>e.json())).then((e=>r(e,"visit count"))),a=e=>e.dataset.path||e.getAttribute("id"),s=(e,t)=>{t.forEach(((t,r)=>{t.innerText=e[r].toString()}))};exports.pageviewCount=({serverURL:t,path:r=window.location.pathname,selector:i=".waline-pageview-count",update:l=!0,lang:h="zh-CN"})=>{const c=new AbortController,p=Array.from(document.querySelectorAll(i)),g=e=>{const t=a(e);return null!==t&&r!==t},u=o=>n({serverURL:t,paths:o.map((e=>a(e)||r)),lang:h,signal:c.signal}).then((e=>s(e,o))).catch(e);if(l){const e=p.filter((e=>!g(e))),n=p.filter(g);o({serverURL:t,path:r,lang:h}).then((t=>s(new Array(e.length).fill(t),e))),n.length&&u(n)}else u(p);return c.abort.bind(c)},exports.version="2.5.0";
//# sourceMappingURL=pageview.cjs.js.map
