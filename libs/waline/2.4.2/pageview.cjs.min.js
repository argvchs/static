"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=e=>{"AbortError"!==e.name&&console.error(e.message)},t={"Content-Type":"application/json"},r=(e,t="")=>{if("object"==typeof e&&e.errno)throw new TypeError(`Fetch ${t} failed with ${e.errno}: `+e.errmsg);return e},n=({serverURL:e,lang:t,paths:n,signal:o})=>fetch(`${e}/article?path=${encodeURIComponent(n.join(","))}&lang=`+t,{signal:o}).then(e=>e.json()).then(e=>r(e,"visit count")).then(e=>Array.isArray(e)?e:[e]),o=({serverURL:e,lang:n,path:o})=>fetch(e+"/article?lang="+n,{method:"POST",headers:t,body:JSON.stringify({path:o})}).then(e=>e.json()).then(e=>r(e,"visit count")),a=e=>e.dataset.path||e.getAttribute("id"),s=(r,e)=>{e.forEach((e,t)=>{e.innerText=r[t].toString()})};exports.pageviewCount=({serverURL:r,path:i=window.location.pathname,selector:t=".waline-pageview-count",update:l=!0,lang:h="zh-CN"})=>{const c=new AbortController,p=Array.from(document.querySelectorAll(t)),g=e=>{e=a(e);return null!==e&&i!==e},u=t=>n({serverURL:r,paths:t.map(e=>a(e)||i),lang:h,signal:c.signal}).then(e=>s(e,t)).catch(e);if(l){const e=p.filter(e=>!g(e)),n=p.filter(g);o({serverURL:r,path:i,lang:h}).then(t=>s(new Array(e.length).fill(t),e)),n.length&&u(n)}else u(p);return c.abort.bind(c)},exports.version="2.4.2";